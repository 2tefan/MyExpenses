<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <title>My Expenses Web User Interface</title>

    <link href="styles.css" rel="stylesheet">

    <script src="https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.8.0/dist/alpine.js" defer></script>
    <!-- Custom styles for this template -->
</head>

<body x-data="{ ip: '', name: '', amount: '', date: '', payee: '', account: 0, notes: '', categoryMain: 0, categorySub: 0, selectedTags: [], count: 0,
accounts: [], payees: [], categories: [], tags: [ {id: 1, label: 'Reise'}, {id: 2, label: 'VÃ¶llerei'} ]}">
<div class="flex justify-center bg-teal-lighter">
    <div class="bg-white max-w-screen-sm w-full rounded shadow-lg p-8 m-4">
        <form>
            <div class="flex flex-col mb-4">
                <label class="mb-2 uppercase font-bold text-lg text-grey-darkest" for="ip">Phone
                    IP</label>
                <input class="border py-2 px-3 text-grey-darkest" type="text" name="ip" id="ip"
                       x-model="ip">
                <button class="block bg-green-500 hover:bg-green-700 text-white uppercase text-lg mx-auto p-4 rounded"
                        type="button" @click="loadData(ip).then(response => response.json())
                              .then(data => { payees = data.payees; accounts = data.accounts; categories = data.categories })">
                    Load
                </button>
            </div>
            <div class="flex flex-col mb-4">
                <label class="mb-2 uppercase font-bold text-lg text-grey-darkest" for="account">Account</label>
                <select name="account" id="account" x-model="account">
                    <template x-for="item in accounts" :key="item.id">
                        <option :value="item.id" x-text="item.label"></option>
                    </template>
                </select>
            </div>

            <div class="flex flex-col mb-4">
                <label class="mb-2 uppercase font-bold text-lg text-grey-darkest" for="amount">Amount</label>
                <div>
                    <input type="checkbox" name="type">
                    <input class="border py-2 px-3 text-grey-darkest" type="number" name="amount" id="amount"
                           x-model="amount">
                </div>
            </div>

            <div class="flex flex-col mb-4">
                <label class="mb-2 uppercase font-bold text-lg text-grey-darkest"
                       for="date">Date</label>
                <input class="border py-2 px-3 text-grey-darkest" type="date" name="date" id="date"
                       x-model="date">
            </div>

            <div class="flex flex-col mb-4">
                <label class="mb-2 uppercase font-bold text-lg text-grey-darkest"
                       for="payee">Payee</label>
                <input class="border py-2 px-3 text-grey-darkest" list="payees" name="payee" id="payee"
                       x-model="payee">
                <datalist id="payees">
                    <template x-for="item in payees" :key="item.id">
                        <option x-text="item.name"></option>
                    </template>
                </datalist>
            </div>

            <div class="flex flex-col mb-4">
                <label class="mb-2 uppercase font-bold text-lg text-grey-darkest"
                       for="category_main">Category</label>
                <div>
                    <select name="category_main" id="category_main" x-model="categoryMain">
                        <option value="0"></option>
                        <template x-for="item in categoriesByParent(categories, 0)" :key="item.id">
                            <option :value="item.id" x-text="item.label"></option>
                        </template>
                    </select>
                    <select name="category_sub" x-model="categorySub" x-show="categoryMain > 0">
                        <option value="0"></option>
                        <template x-for="item in categoriesByParent(categories, categoryMain)" :key="item.id">
                            <option :value="item.id" x-text="item.label"></option>
                        </template>
                    </select>
                </div>
            </div>

            <div class="flex flex-col mb-4">
                <label class="mb-2 uppercase font-bold text-lg text-grey-darkest" for="tags">Tags</label>
                <select name="tags" id="tags" multiple x-model="selectedTags">
                    <template x-for="item in tags" :key="item.id">
                        <option :value="item.id" x-text="item.label"></option>
                    </template>
                </select>
            </div>

            <div class="flex flex-col mb-4">
                <label class="mb-2 uppercase font-bold text-lg text-grey-darkest" for="notes">Notes</label>
                <textarea name="notes" id="notes" x-model="notes"></textarea>
            </div>

            <div>
                <button class="block bg-green-500 hover:bg-green-700 disabled:opacity-50 text-white uppercase text-lg mx-auto p-4 rounded"
                        type="button" :disabled="categoryMain == 1"  @click="submitForm(ip, {amount: amount}).then(() => {
                        count++;
                      })">Submit
                </button>
                <div x-show="count > 0"><span x-text="count"></span> transactions have been
                    recorded.
                </div>
            </div>
        </form>
    </div>
</div>

<script>
function categoriesByParent(array, parent) {
    console.log(parent)
    return array.filter(item => item.parent == parent)
}
function loadData(ip) {
    return fetch(server(ip))
}
function submitForm(ip, data){
    return fetch(server(ip), {
      method: 'POST',
      body: JSON.stringify(data)
    });
}

function server(ip) {
    return 'http://'+ ip + ':9000/'
}
</script>

</body>
</html>